<div class="manage-page">
  <h1>Manage Categories, Subcategories & Tags</h1>

  <!-- Export/Import Section -->
  <mat-card class="export-import-card">
    <mat-card-header>
      <mat-card-title>Data Export & Import</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="export-import-actions">
        <!-- Export Button -->
        <div class="export-section">
          <button
            mat-raised-button
            color="primary"
            (click)="exportData()"
            [disabled]="isExporting()"
          >
            <mat-icon *ngIf="!isExporting()">download</mat-icon>
            <mat-spinner *ngIf="isExporting()" diameter="20"></mat-spinner>
            {{ isExporting() ? 'Exporting...' : 'Export Data' }}
          </button>
          <p class="action-description">Download all your data as a JSON backup file</p>
        </div>

        <mat-divider vertical></mat-divider>

        <!-- Import Section -->
        <div class="import-section">
          <button
            mat-raised-button
            color="accent"
            (click)="triggerFileInput()"
            [disabled]="isImporting()"
          >
            <mat-icon *ngIf="!isImporting()">upload</mat-icon>
            <mat-spinner *ngIf="isImporting()" diameter="20"></mat-spinner>
            {{ isImporting() ? 'Importing...' : 'Import Data' }}
          </button>
          <p class="action-description">
            Restore data from a backup file (replaces all existing data)
          </p>

          <!-- Hidden file input -->
          <input
            #fileInput
            type="file"
            accept=".json"
            (change)="importData($event)"
            style="display: none"
          />
        </div>

        <mat-divider vertical></mat-divider>

        <!-- Demo Data Seeding Section -->
        <div class="demo-section">
          <button
            mat-raised-button
            color="warn"
            (click)="seedDemoData()"
            [disabled]="isSeedingDemo()"
          >
            <mat-icon *ngIf="!isSeedingDemo()">science</mat-icon>
            <mat-spinner *ngIf="isSeedingDemo()" diameter="20"></mat-spinner>
            {{ isSeedingDemo() ? 'Seeding...' : 'Seed Demo Data' }}
          </button>
          <p class="action-description">
            <strong>[DEV]</strong> Add sample data for testing (clears existing data)
          </p>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <div class="manage-sections">
    <!-- Categories Section -->
    <mat-card class="section-card">
      <mat-card-header>
        <mat-card-title>Categories</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <!-- Add Category Form -->
        <div class="add-form">
          <mat-form-field appearance="outline">
            <mat-label>New Category Name</mat-label>
            <input
              matInput
              [(ngModel)]="newCategoryName"
              placeholder="Enter category name"
              (keyup.enter)="addCategory()"
            />
          </mat-form-field>
          <button
            mat-raised-button
            color="primary"
            (click)="addCategory()"
            [disabled]="!newCategoryName.trim()"
          >
            Add Category
          </button>
        </div>

        <!-- Categories List -->
        <div class="items-list">
          @if (categories().length === 0) {
          <p class="no-items">No categories yet. Add one above.</p>
          } @else {
          <mat-list>
            @for (category of categories(); track category.id) {
            <mat-list-item class="list-item">
              <span class="item-name">{{ category.name }}</span>
              <button
                mat-icon-button
                color="warn"
                (click)="deleteCategory(category)"
                class="delete-btn"
              >
                <mat-icon>delete</mat-icon>
              </button>
            </mat-list-item>
            }
          </mat-list>
          }
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Subcategories Section -->
    <mat-card class="section-card">
      <mat-card-header>
        <mat-card-title>Subcategories</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <!-- Add Subcategory Form -->
        <div class="add-form">
          <mat-form-field appearance="outline">
            <mat-label>Parent Category</mat-label>
            <mat-select [(value)]="selectedCategoryId">
              @for (category of categories(); track category.id) {
              <mat-option [value]="category.id">
                {{ category.name }}
              </mat-option>
              }
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>New Subcategory Name</mat-label>
            <input
              matInput
              [(ngModel)]="newSubcategoryName"
              placeholder="Enter subcategory name"
              (keyup.enter)="addSubcategory()"
            />
          </mat-form-field>

          <button
            mat-raised-button
            color="primary"
            (click)="addSubcategory()"
            [disabled]="!canAddSubcategory"
          >
            Add Subcategory
          </button>
        </div>

        <!-- Subcategories List -->
        <div class="items-list">
          @if (subcategories().length === 0) {
          <p class="no-items">No subcategories yet. Add one above.</p>
          } @else {
          <mat-list>
            @for (subcategory of subcategories(); track subcategory.id) {
            <mat-list-item class="list-item">
              <div class="subcategory-info">
                <span class="item-name">{{ subcategory.name }}</span>
                <span class="parent-category">{{ getCategoryName(subcategory.categoryId) }}</span>
              </div>
              <button
                mat-icon-button
                color="warn"
                (click)="deleteSubcategory(subcategory)"
                class="delete-btn"
              >
                <mat-icon>delete</mat-icon>
              </button>
            </mat-list-item>
            }
          </mat-list>
          }
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Tags Section -->
    <mat-card class="section-card">
      <mat-card-header>
        <mat-card-title>Tags</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <!-- Add Tag Form -->
        <div class="add-form">
          <mat-form-field appearance="outline">
            <mat-label>New Tag Name</mat-label>
            <input
              matInput
              [(ngModel)]="newTagName"
              placeholder="Enter tag name"
              (keyup.enter)="addTag()"
            />
          </mat-form-field>
          <button
            mat-raised-button
            color="primary"
            (click)="addTag()"
            [disabled]="!newTagName.trim()"
          >
            Add Tag
          </button>
        </div>

        <!-- Tags List -->
        <div class="items-list">
          @if (tags().length === 0) {
          <p class="no-items">No tags yet. Add one above.</p>
          } @else {
          <mat-list>
            @for (tag of tags(); track tag.id) {
            <mat-list-item class="list-item">
              <span class="item-name">{{ tag.name }}</span>
              <button mat-icon-button color="warn" (click)="deleteTag(tag)" class="delete-btn">
                <mat-icon>delete</mat-icon>
              </button>
            </mat-list-item>
            }
          </mat-list>
          }
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
